{% extends "admin_panel/base_dashboard.html" %}
{% load static %}

{% block dashboard_content %}

<div class="flex flex-col justify-start items-start w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="flex flex-col justify-start items-start w-full">
    
    <!-- Header Section -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center w-full gap-4 pb-6">
      <div class="flex justify-start items-center">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Menu Management</h1>
      </div>
      <a href="#" class="flex justify-center items-center w-full sm:w-auto px-4 py-2 rounded-lg bg-amber-600 hover:bg-amber-700 transition gap-2">
        <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4">
          <path d="M7.70169 7.36217L7.71676 3.36219L9.0505 3.36722L9.03543 7.36719L13.0367 7.38226L13.0316 8.71558L9.03041 8.70051L9.01535 12.7005L7.68161 12.6955L7.69667 8.69549L3.69545 8.68042L3.70047 7.34709L7.70169 7.36217Z" fill="white"></path>
        </svg>
        <span class="text-base font-medium text-white">Add New Item</span>
      </a>
    </div>

    <!-- Search & Filter Section -->
    <div class="w-full pt-6 pb-6">
      <form method="GET" class="w-full overflow-hidden p-4 sm:p-6 rounded-lg bg-white shadow-sm">
        
        <!-- Search Input -->
        <div class="mb-4">
          <div class="flex justify-start items-center w-full h-auto relative px-4 py-2 sm:py-3 rounded-lg bg-white border border-gray-300">
            <input 
              type="text" 
              name="search" 
              value="{{ search_query }}" 
              placeholder="Search menu items..." 
              class="flex-grow w-full text-sm font-medium text-left text-gray-700 outline-none bg-transparent"
            >
          </div>
        </div>

        <!-- Category Filter - Responsive Grid -->
        <div class="flex flex-wrap justify-start items-center gap-2">
          <a href="{% url 'admin-menu' %}" class="flex justify-center items-center px-3 sm:px-4 py-2 rounded-lg text-sm font-medium transition {% if not selected_category %}bg-amber-100 border border-amber-300 text-amber-800{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
            All Categories
          </a>

          {% for category in categories %}
            <a href="?category={{ category.id }}" class="flex justify-center items-center px-3 sm:px-4 py-2 rounded-lg text-sm font-medium transition whitespace-nowrap {% if selected_category|add:'0' == category.id %}bg-amber-100 border border-amber-300 text-amber-800{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
              {{ category.subcategory }}
            </a>
          {% endfor %}
        </div>
      </form>
    </div>

    <!-- Menu Items Grid - Responsive -->
    <div class="w-full pt-6">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 w-full">
        
        {% for item in menu_items %}
          <div class="flex flex-col justify-start items-start h-auto overflow-hidden rounded-lg bg-white shadow-sm hover:shadow-md transition">
            
            <!-- Image Section -->
            <div class="flex flex-col justify-start items-start w-full h-48 sm:h-56 relative overflow-hidden bg-gray-200">
              <img 
                src="{% if item.menu_img %}{{ item.menu_img.url }}{% else %}{% static 'images/placeholder.jpg' %}{% endif %}" 
                class="w-full h-full object-cover" 
                alt="{{ item.name }}"
              >
              
              <!-- Status Badges -->
              <div class="flex justify-start items-start flex-wrap gap-2 absolute left-2 top-2">
                {% if item.is_available %}
                  <div class="flex justify-start items-center px-2 py-1 rounded bg-green-100">
                    <p class="text-xs font-medium text-green-800">Available</p>
                  </div>
                {% else %}
                  <div class="flex justify-start items-center px-2 py-1 rounded bg-red-100">
                    <p class="text-xs font-medium text-red-800">Unavailable</p>
                  </div>
                {% endif %}
              </div>

              <!-- Edit Button -->
              <div class="absolute right-2 top-2">
                <button class="flex justify-center items-center w-10 h-10 p-2 rounded-full bg-white/90 hover:bg-white transition shadow-sm" title="Edit item">
                  <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4">
                    <path d="M4.05696 9.33683L9.99842 3.44417L9.17262 2.61272L3.23111 8.51705L3.22804 9.33371L4.05696 9.33683ZM4.53123 10.5053L2.05615 10.496L2.06547 8.02265L8.76866 1.37452C8.87803 1.26604 9.01444 1.21211 9.17789 1.21273C9.34134 1.21334 9.47735 1.2683 9.5859 1.3776L11.2375 3.0405C11.3538 3.14983 11.4117 3.28616 11.4111 3.44949C11.4105 3.61282 11.3516 3.7526 11.2344 3.86883L4.53123 10.5053ZM2.05176 11.6626L12.5592 11.7022L12.5548 12.8689L2.04736 12.8293L2.05176 11.6626Z" fill="#4B5563"></path>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Content Section -->
            <div class="flex flex-col justify-start items-start w-full p-4 gap-3">
              
              <!-- Title & Price -->
              <div class="flex justify-between items-start w-full gap-2">
                <div class="flex flex-col justify-start items-start flex-grow">
                  <h3 class="text-base sm:text-lg font-semibold text-gray-900 line-clamp-2">{{ item.name }}</h3>
                  <p class="text-sm text-gray-500">{{ item.subcategory_id.subcategory }}</p>
                </div>
                <p class="text-lg sm:text-xl font-bold text-amber-600 whitespace-nowrap">Rs {{ item.price }}</p>
              </div>

              <!-- Description -->
              <div class="w-full">
                <p class="text-sm text-gray-600 line-clamp-2">{{ item.desc }}</p>
              </div>

              <!-- Action Buttons -->
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center w-full pt-3 border-t border-gray-200 gap-3 mt-auto">
                <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
                  
                  <!-- Toggle Availability -->
                  <form method="POST" class="w-full sm:w-auto">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="toggle_availability">
                    <input type="hidden" name="item_id" value="{{ item.item_id }}">
                    <button type="submit" class="w-full sm:w-auto px-3 py-1 rounded text-xs font-medium transition {% if item.is_available %}bg-red-100 text-red-800 hover:bg-red-200{% else %}bg-green-100 text-green-800 hover:bg-green-200{% endif %}">
                      {% if item.is_available %}Make Unavailable{% else %}Make Available{% endif %}
                    </button>
                  </form>
                </div>

                <!-- Delete Button -->
                <form method="POST" class="w-full sm:w-auto" onsubmit="return confirm('Are you sure you want to delete this item?');">
                  {% csrf_token %}
                  <input type="hidden" name="action" value="delete">
                  <input type="hidden" name="item_id" value="{{ item.item_id }}">
                  <button type="submit" class="flex justify-center items-center w-full sm:w-auto p-1 text-red-600 hover:text-red-800 transition">
                    <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5">
                      <path d="M11.7153 4.04394L15.0497 4.0565L15.0446 5.38982L13.7109 5.3848L13.6783 14.0514C13.6776 14.2381 13.6125 14.3956 13.4831 14.524C13.3537 14.6524 13.1956 14.7163 13.0089 14.7156L3.67269 14.6804C3.48597 14.6797 3.32839 14.6146 3.19994 14.4853C3.0715 14.3559 3.00763 14.1979 3.00833 14.0112L3.04098 5.34461L1.70724 5.33958L1.71226 4.00626L5.04661 4.01882L5.05414 2.01883C5.05485 1.83217 5.11991 1.67464 5.24932 1.54623C5.37873 1.41783 5.5368 1.35398 5.72353 1.35468L11.0585 1.37478C11.2452 1.37548 11.4028 1.44052 11.5312 1.5699C11.6597 1.69927 11.7235 1.85729 11.7228 2.04395L11.7153 4.04394ZM12.3772 5.37977L4.37472 5.34963L4.34459 13.3496L12.347 13.3797L12.3772 5.37977ZM6.3678 7.35715L7.70154 7.36218L7.68647 11.3621L6.35273 11.3571L6.3678 7.35715ZM9.03528 7.3672L10.369 7.37222L10.354 11.3722L9.02021 11.3672L9.03528 7.3672ZM6.38537 2.69052L6.38035 4.02384L10.3816 4.03892L10.3866 2.70559L6.38537 2.69052Z" fill="currentColor"></path>
                    </svg>
                  </button>
                </form>
              </div>
            </div>
          </div>
        {% empty %}
          <div class="col-span-1 sm:col-span-2 lg:col-span-3 py-8 text-center">
            <p class="text-gray-500">No menu items found.</p>
          </div>
        {% endfor %}
      </div>
    </div>

  </div>
</div>

{% endblock %}